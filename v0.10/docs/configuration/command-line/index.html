<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.58.3" />

<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/v0.10/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/v0.10/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/v0.10/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/v0.10/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/v0.10/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/v0.10/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/v0.10/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/v0.10/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/v0.10/favicons/android-192x192.png" sizes="192x192">

<title>Command-line options | HAProxy Ingress</title><meta property="og:title" content="Command-line options" />
<meta property="og:description" content="Static command-line configuration options.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/v0.10/docs/configuration/command-line/" />
<meta property="article:modified_time" content="2021-07-09T09:06:33-03:00" /><meta property="og:site_name" content="HAProxy Ingress" />
<meta itemprop="name" content="Command-line options">
<meta itemprop="description" content="Static command-line configuration options.
">


<meta itemprop="dateModified" content="2021-07-09T09:06:33-03:00" />
<meta itemprop="wordCount" content="2071">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Command-line options"/>
<meta name="twitter:description" content="Static command-line configuration options.
"/>







<link rel="preload" href="/v0.10/scss/main.min.09e7d522d5846094a77df8fe690c2672d05ec6a02218a7463cb37d7c6962580c.css" as="style">
<link href="/v0.10/scss/main.min.09e7d522d5846094a77df8fe690c2672d05ec6a02218a7463cb37d7c6962580c.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>


<script>
  var _paq = window._paq = window._paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//tags.joaomora.is/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '3']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//tags.joaomora.is/matomo.php?idsite=3&amp;rec=1" style="border:0;" alt="" /></p></noscript>


    <title>Command-line options | HAProxy Ingress</title>
  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/v0.10/">
		<span class="navbar-logo"></span><span class="text-uppercase font-weight-bold">HAProxy Ingress</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/v0.10/about/" ><span>About</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/v0.10/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/v0.10/community/" ><span>Community</span></a>
			</li>
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	v0.10
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://haproxy-ingress.github.io/docs">Latest</a>
	
	<a class="dropdown-item" href="https://haproxy-ingress.github.io/v0.10/docs">v0.10</a>
	
	<a class="dropdown-item" href="https://haproxy-ingress.github.io/v0.9/docs">v0.9</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v0.10/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Documentation</a>
  </li>
  <ul>
    <li class="collapse show" id="v0-10-docs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v0.10/docs/overview/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Overview</a>
  </li>
  <ul>
    <li class="collapse " id="v0-10-docs-overview">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v0.10/docs/getting-started/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Getting Started</a>
  </li>
  <ul>
    <li class="collapse " id="v0-10-docs-getting-started">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v0.10/docs/examples/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Examples</a>
  </li>
  <ul>
    <li class="collapse " id="v0-10-docs-examples">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v0-10-docs-examples-blue-green" href="/v0.10/docs/examples/blue-green/">Blue/green</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v0-10-docs-examples-metrics" href="/v0.10/docs/examples/metrics/">Metrics</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v0-10-docs-examples-modsecurity" href="/v0.10/docs/examples/modsecurity/">ModSecurity</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v0.10/docs/configuration/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Configuration</a>
  </li>
  <ul>
    <li class="collapse show" id="v0-10-docs-configuration">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v0-10-docs-configuration-template" href="/v0.10/docs/configuration/template/">Template</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page  active" id="m-v0-10-docs-configuration-command-line" href="/v0.10/docs/configuration/command-line/">Command-line</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-v0-10-docs-configuration-keys" href="/v0.10/docs/configuration/keys/">Keys</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/v0.10/docs/contribution-guidelines/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Contribution Guidelines</a>
  </li>
  <ul>
    <li class="collapse " id="v0-10-docs-contribution-guidelines">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            





<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/jcmoraisjr/haproxy-ingress/edit/master/docs/content/en/docs/configuration/command-line.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/jcmoraisjr/haproxy-ingress/issues/new?title=Command-line%20options" target="_blank"><i class="fab fa-github fa-fw"></i> Create doc issue</a>

</div>






<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#acme">Acme</a></li>
<li><a href="#allow-cross-namespace">&ndash;allow-cross-namespace</a></li>
<li><a href="#annotation-prefix">&ndash;annotation-prefix</a></li>
<li><a href="#buckets-response-time">&ndash;buckets-response-time</a></li>
<li><a href="#default-backend-service">&ndash;default-backend-service</a></li>
<li><a href="#default-ssl-certificate">&ndash;default-ssl-certificate</a></li>
<li><a href="#disable-config-keywords">&ndash;disable-config-keywords</a></li>
<li><a href="#disable-external-name">&ndash;disable-external-name</a></li>
<li><a href="#ignore-ingress-without-class">&ndash;ignore-ingress-without-class</a></li>
<li><a href="#ingress-class">&ndash;ingress-class</a></li>
<li><a href="#kubeconfig">&ndash;kubeconfig</a></li>
<li><a href="#max-old-config-files">&ndash;max-old-config-files</a></li>
<li><a href="#publish-service">&ndash;publish-service</a></li>
<li><a href="#rate-limit-update">&ndash;rate-limit-update</a></li>
<li><a href="#reload-strategy">&ndash;reload-strategy</a></li>
<li><a href="#sort-backends">&ndash;sort-backends</a></li>
<li><a href="#stats">Stats</a></li>
<li><a href="#tcp-services-configmap">&ndash;tcp-services-configmap</a></li>
<li><a href="#verify-hostname">&ndash;verify-hostname</a></li>
<li><a href="#wait-before-shutdown">&ndash;wait-before-shutdown</a></li>
<li><a href="#watch-namespace">&ndash;watch-namespace</a></li>
</ul></li>
</ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/v0.10/docs/">Documentation</a>
</li>




<li class="breadcrumb-item" >
	<a href="/v0.10/docs/configuration/">Configuration</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/v0.10/docs/configuration/command-line/">Command-line</a>
</li>

	</ol>
</nav	>

            
<div class="td-content">
	<div class="alert alert-secondary" role="alert">
		<h3>This page refers to v0.10 documentation</h3>
	</div>
	<h1>Command-line options</h1>
	<div class="lead">Static command-line configuration options.</div>
	

<p>The following command-line options are supported:</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Since</th>
</tr>
</thead>

<tbody>
<tr>
<td><a href="#acme"><code>--acme-check-period</code></a></td>
<td>time</td>
<td><code>24h</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-election-id</code></a></td>
<td>[namespace]/configmap-name</td>
<td><code>acme-leader</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-fail-initial-duration</code></a></td>
<td>time</td>
<td><code>5m</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-fail-max-duration</code></a></td>
<td>time</td>
<td><code>8h</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-secret-key-name</code></a></td>
<td>[namespace]/secret-name</td>
<td><code>acme-private-key</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-server</code></a></td>
<td>[true|false]</td>
<td><code>false</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-token-configmap-name</code></a></td>
<td>[namespace]/configmap-name</td>
<td><code>acme-validation-tokens</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#acme"><code>--acme-track-tls-annotation</code></a></td>
<td>[true|false]</td>
<td><code>false</code></td>
<td>v0.9</td>
</tr>

<tr>
<td><a href="#allow-cross-namespace"><code>--allow-cross-namespace</code></a></td>
<td>[true|false]</td>
<td><code>false</code></td>
<td></td>
</tr>

<tr>
<td><a href="#annotation-prefix"><code>--annotation-prefix</code></a></td>
<td>prefix without <code>/</code></td>
<td><code>ingress.kubernetes.io</code></td>
<td>v0.8</td>
</tr>

<tr>
<td><a href="#buckets-response-time"><code>--buckets-response-time</code></a></td>
<td>float64 slice</td>
<td><code>.0005,.001,.002,.005,.01</code></td>
<td>v0.10</td>
</tr>

<tr>
<td><a href="#default-backend-service"><code>--default-backend-service</code></a></td>
<td>namespace/servicename</td>
<td>haproxy&rsquo;s 404 page</td>
<td></td>
</tr>

<tr>
<td><a href="#default-ssl-certificate"><code>--default-ssl-certificate</code></a></td>
<td>namespace/secretname</td>
<td>fake, auto generated</td>
<td></td>
</tr>

<tr>
<td><a href="#disable-config-keywords"><code>--disable-config-keywords</code></a></td>
<td>comma-separated list of keywords</td>
<td><code>&quot;&quot;</code></td>
<td>v0.10</td>
</tr>

<tr>
<td><a href="#disable-external-name"><code>--disable-external-name</code></a></td>
<td>[true|false]</td>
<td><code>false</code></td>
<td>v0.10</td>
</tr>

<tr>
<td><a href="#stats"><code>--healthz-port</code></a></td>
<td>port number</td>
<td><code>10254</code></td>
<td></td>
</tr>

<tr>
<td><a href="#ignore-ingress-without-class"><code>--ignore-ingress-without-class</code></a></td>
<td>[true|false]</td>
<td><code>false</code></td>
<td>v0.10</td>
</tr>

<tr>
<td><a href="#ingress-class"><code>--ingress-class</code></a></td>
<td>name</td>
<td><code>haproxy</code></td>
<td></td>
</tr>

<tr>
<td><a href="#kubeconfig"><code>--kubeconfig</code></a></td>
<td>/path/to/kubeconfig</td>
<td>in cluster config</td>
<td></td>
</tr>

<tr>
<td><a href="#max-old-config-files"><code>--max-old-config-files</code></a></td>
<td>num of files</td>
<td><code>0</code></td>
<td></td>
</tr>

<tr>
<td><a href="#stats"><code>--profiling</code></a></td>
<td>[true|false]</td>
<td><code>true</code></td>
<td></td>
</tr>

<tr>
<td><a href="#publish-service"><code>--publish-service</code></a></td>
<td>namespace/servicename</td>
<td></td>
<td></td>
</tr>

<tr>
<td><a href="#rate-limit-update"><code>--rate-limit-update</code></a></td>
<td>uploads per second (float)</td>
<td><code>0.5</code></td>
<td></td>
</tr>

<tr>
<td><a href="#reload-strategy"><code>--reload-strategy</code></a></td>
<td>[native|reusesocket]</td>
<td><code>reusesocket</code></td>
<td></td>
</tr>

<tr>
<td><a href="#sort-backends"><code>--sort-backends</code></a></td>
<td>[true|false]</td>
<td><code>false</code></td>
<td></td>
</tr>

<tr>
<td><a href="#stats"><code>--stats-collect-processing-period</code></a></td>
<td>time</td>
<td><code>500ms</code></td>
<td>v0.10</td>
</tr>

<tr>
<td><a href="#tcp-services-configmap"><code>--tcp-services-configmap</code></a></td>
<td>namespace/configmapname</td>
<td>no tcp svc</td>
<td></td>
</tr>

<tr>
<td><a href="#verify-hostname"><code>--verify-hostname</code></a></td>
<td>[true|false]</td>
<td><code>true</code></td>
<td></td>
</tr>

<tr>
<td><a href="#wait-before-shutdown"><code>--wait-before-shutdown</code></a></td>
<td>seconds as integer</td>
<td><code>0</code></td>
<td>v0.8</td>
</tr>

<tr>
<td><a href="#watch-namespace"><code>--watch-namespace</code></a></td>
<td>namespace</td>
<td>all namespaces</td>
<td></td>
</tr>
</tbody>
</table>

<hr />

<h2 id="acme">Acme</h2>

<p>Configures the acme server and other static options used to authorize and sign certificates
against a server which implements the acme protocol, version 2.</p>

<p>Supported acme command-line options:</p>

<ul>
<li><code>--acme-check-period</code>: interval between checks for expiring certificates. Defaults to <code>24h</code>.</li>
<li><code>--acme-election-id</code>: prefix of the ConfigMap name used to store the leader election data. Only the leader of a haproxy-ingress cluster should start the authorization and sign certificate process. Defaults to <code>acme-leader</code>.</li>
<li><code>--acme-fail-initial-duration</code>: the starting time to wait and retry after a failed authorization and sign process. Defaults to <code>5m</code>.</li>
<li><code>--acme-fail-max-duration</code>: the time between retries of failed authorization will exponentially grow up to the max duration time. Defaults to <code>8h</code>.</li>
<li><code>--acme-secret-key-name</code>: secret name used to store the client private key. Defaults to <code>acme-private-key</code>. A new key, hence a new client, is created if the secret does not exist.</li>
<li><code>--acme-server</code>: mandatory, starts a local server used to answer challenges from the acme environment. This option should be provided on all haproxy-ingress instances to the certificate signing work properly.</li>
<li><code>--acme-token-configmap-name</code>: the ConfigMap name used to store temporary tokens generated during the challenge. Defaults to <code>acme-validation-tokens</code>. Such tokens need to be stored in k8s because any haproxy-ingress instance might receive the request from the acme environment.</li>
<li><code>--acme-track-tls-annotation</code>: defines if ingress objects with annotation <code>kubernetes.io/tls-acme: &quot;true&quot;</code> should also be tracked. Defaults to <code>false</code>.</li>
</ul>

<p>See also:</p>

<ul>
<li><a href="/v0.10/docs/configuration/keys/#acme">acme configuration keys</a> doc, which has also an overview on how acme works on haproxy-ingress</li>
</ul>

<hr />

<h2 id="allow-cross-namespace">&ndash;allow-cross-namespace</h2>

<p><code>--allow-cross-namespace</code> argument, if added, will allow reading secrets from one namespace to an
ingress resource of another namespace. The default behavior is to deny such cross namespace reading.
This adds a breaking change from <code>v0.4</code> to <code>v0.5</code> on <code>ingress.kubernetes.io/auth-tls-secret</code>
annotation, where cross namespace reading were allowed without any configuration.</p>

<hr />

<h2 id="annotation-prefix">&ndash;annotation-prefix</h2>

<p>Changes the annotation prefix the controller should look for when parsing services and ingress
objects. The default value is <code>ingress.kubernetes.io</code> if not declared, which means SSL Redirect
should be configured with the annotation name <code>ingress.kubernetes.io/ssl-redirect</code>. Annotations
with other prefix are ignored. This allows using HAProxy Ingress with other ingress controllers
that shares ingress and service objects without conflicting each other.</p>

<hr />

<h2 id="buckets-response-time">&ndash;buckets-response-time</h2>

<p>Configures the buckets of the histogram <code>haproxyingress_haproxy_response_time_seconds</code>, used to compute the response time of the haproxy&rsquo;s admin socket. The response time unit is in seconds.</p>

<hr />

<h2 id="default-backend-service">&ndash;default-backend-service</h2>

<p>Defines the <code>namespace/servicename</code> that should be used if the incoming request doesn&rsquo;t match any
hostname, or the requested path doesn&rsquo;t match any location within the desired hostname. An internal
404 error page is used if not declared.</p>

<hr />

<h2 id="default-ssl-certificate">&ndash;default-ssl-certificate</h2>

<p>Defines the <code>namespace/secretname</code> of the default certificate that should be used if ingress
resources using TLS configuration doesn&rsquo;t provide it&rsquo;s own certificate. A self-signed fake
certificate is used if not declared.</p>

<hr />

<h2 id="disable-config-keywords">&ndash;disable-config-keywords</h2>

<p>Since v0.10.9</p>

<p>Defines a comma-separated list of HAProxy keywords that should not be used on annotation based configuration snippets. Configuration snippets added as a global config does not follow this option. Use an asterisk <code>*</code> to disable configuration snippets using annotations.</p>

<p>Every keyword in the configuration will be compared with the first token of every configuration line, ignoring tabs and spaces. If a match occur, all the configuration snippet will be ignored and a warning is logged.</p>

<p>The default value is an empty string, enabling the configuration and accepting any HAProxy keyword.</p>

<hr />

<h2 id="disable-external-name">&ndash;disable-external-name</h2>

<p>Since v0.10.9</p>

<p>Services of type ExternalName uses DNS lookup to define the target server IP list. Declare <code>--disable-external-name</code> to disable a DNS based target IP list, refusing services of type ExternalName.</p>

<hr />

<h2 id="ignore-ingress-without-class">&ndash;ignore-ingress-without-class</h2>

<p>Defines if the ingress without the ingress.class annotation will be considered or not. If <code>--ignore-ingress-without-class=true</code> then only the ingresses with the matching ingress.class annotation will be considered, ingresses with missing or different ingress.class annotation will not be considered. Default is false.</p>

<hr />

<h2 id="ingress-class">&ndash;ingress-class</h2>

<p>More than one ingress controller is supported per Kubernetes cluster. The <code>--ingress-class</code>
argument allow to override the class name of ingress resources that this instance of the
controller should listen to. Class names that match will be used in the HAProxy configuration.
Other classes will be ignored.</p>

<p>The ingress resource must use the <code>kubernetes.io/ingress.class</code> annotation to name it&rsquo;s
ingress class.</p>

<hr />

<h2 id="kubeconfig">&ndash;kubeconfig</h2>

<p>Ingress controller will try to connect to the Kubernetes master using environment variables and a
service account. This behavior can be changed using <code>--kubeconfig</code> argument that reference a
kubeconfig file with master endpoint and credentials. This is a mandatory argument if the controller
is deployed outside of the Kubernetes cluster.</p>

<hr />

<h2 id="max-old-config-files">&ndash;max-old-config-files</h2>

<p>Everytime a configuration change need to update HAProxy, a configuration file is rewritten even if
dynamic update is used. By default the same file is recreated and the old configuration is lost.
Use <code>--max-old-config-files</code> to configure after how much files Ingress controller should start to
remove old configuration files. If <code>0</code>, the default value, a single <code>haproxy.cfg</code> is used.</p>

<hr />

<h2 id="publish-service">&ndash;publish-service</h2>

<p>Some infrastructure tools like <code>external-DNS</code> relay in the ingress status to created access routes to the services exposed with ingress object.</p>

<pre><code>apiVersion: extensions/v1beta1
kind: Ingress
...
status:
  loadBalancer:
    ingress:
    - hostname: &lt;ingressControllerLoadbalancerFQDN&gt;
</code></pre>

<p>Use <code>--publish-service=namespace/servicename</code> to indicate the services fronting the ingress controller. The controller mirrors the address of this service&rsquo;s endpoints to the load-balancer status of all Ingress objects it satisfies.</p>

<hr />

<h2 id="rate-limit-update">&ndash;rate-limit-update</h2>

<p>Use <code>--rate-limit-update</code> to change how much time to wait between HAProxy reloads. Note that the first
update is always immediate, the delay will only prevent two or more updates in the same time frame.
Moreover reloads will only occur if the cluster configuration has changed, otherwise no reload will
occur despite of the rate limit configuration.</p>

<p>This argument receives the allowed reloads per second. The default value is <code>0.5</code> which means no more
than one reload will occur within <code>2</code> seconds. The lower limit is <code>0.05</code> which means one reload within
<code>20</code> seconds. The highest one is <code>10</code> which will allow ingress controller to reload HAProxy up to 10
times per second.</p>

<hr />

<h2 id="reload-strategy">&ndash;reload-strategy</h2>

<p>The <code>--reload-strategy</code> command-line argument is used to select which reload strategy
HAProxy should use. The following options are available:</p>

<ul>
<li><code>native</code>: Uses native HAProxy reload option <code>-sf</code>.</li>
<li><code>reusesocket</code>: (starting on v0.6) Uses HAProxy <code>-x</code> command-line option to pass the listening sockets between old and new HAProxy process, allowing hitless reloads. This is the default option since v0.8.</li>
<li><code>multibinder</code>: (deprecated on v0.6) Uses GitHub&rsquo;s <a href="https://github.com/github/multibinder">multibinder</a>. This <a href="https://githubengineering.com/glb-part-2-haproxy-zero-downtime-zero-delay-reloads-with-multibinder/">link</a>
describes how it works.</li>
</ul>

<hr />

<h2 id="sort-backends">&ndash;sort-backends</h2>

<p>Defines if backend&rsquo;s endpoints should be sorted by name. Since v0.8 the endpoints will stay in the
same order found in the Kubernetes&rsquo; endpoint objects if <code>--sort-backends</code> is missing.</p>

<p>In v0.7 and older version, if <code>--sort-backends</code> is missing, HAProxy Ingress randomly shuffle endpoints
on each reload in order to avoid requesting always the same backends just after haproxy reloads.</p>

<p>Sorting backends by name has a real effect only if using a distinct <a href="/v0.10/docs/configuration/keys/#backend-server-naming">backend-server-naming</a>
option, because the default value builds the server name using a numeric sequence.</p>

<p>See also:</p>

<ul>
<li><a href="/v0.10/docs/configuration/keys/#backend-server-naming">backend-server-naming</a> configuration key</li>
</ul>

<hr />

<h2 id="stats">Stats</h2>

<p>Configures an endpoint with statistics, debugging and health checks. The following URIs are provided:</p>

<ul>
<li><code>/healthz</code>: a healthz URI for the haproxy-ingress</li>
<li><code>/metrics</code>: Prometheus compatible metrics exporter</li>
<li><code>/acme/check</code> (<code>POST</code>): starts check for missing, expiring or outdated certificates controlled by acme client. Should be issued in the leader.</li>
<li><code>/debug/pprof</code>: profiling tools</li>
<li><code>/build</code>: build information - controller name, version, git commit hash and repository</li>
<li><code>/stop</code>: stops haproxy-ingress controller</li>
</ul>

<p>Options:</p>

<ul>
<li><code>--healthz-port</code>: Defines the port number haproxy-ingress should listen to. Defaults to <code>10254</code>.</li>
<li><code>--profiling</code>: Configures if the profiling URI should be enabled. Defaults to <code>true</code>.</li>
<li><code>--stats-collect-processing-period</code>: Defines the interval between two consecutive readings of haproxy&rsquo;s <code>Idle_pct</code>, used to generate <code>haproxy_processing_seconds_total</code> metric. haproxy updates Idle_pct every <code>500ms</code>, which makes that the best configuration value, and it&rsquo;s also the default if not configured. Values higher than <code>500ms</code> will produce a less accurate collect. Change to 0 (zero) to disable this metric.</li>
</ul>

<hr />

<h2 id="tcp-services-configmap">&ndash;tcp-services-configmap</h2>

<p>Configure <code>--tcp-services-configmap</code> argument with <code>namespace/configmapname</code> resource with TCP
services and ports that HAProxy should listen to. Use the HAProxy&rsquo;s port number as the key of the
ConfigMap.</p>

<p>The value of the ConfigMap entry is a colon separated list of the following arguments:</p>

<ol>
<li><code>&lt;namespace&gt;/&lt;service-name&gt;</code>, mandatory, is the well known notation of the service that will receive incoming connections.</li>
<li><code>&lt;portnumber&gt;</code>, mandatory, is the port number the upstream service is listening - this is not related to the listening port of HAProxy.</li>
<li><code>&lt;in-proxy&gt;</code>, optional, should be defined as <code>PROXY</code> if HAProxy should expect requests using the <a href="https://www.haproxy.org/download/2.0/doc/proxy-protocol.txt">PROXY</a> protocol. Leave empty to not use PROXY protocol. This is usually used only if there is another load balancer in front of HAProxy which supports the PROXY protocol. PROXY protocol v1 and v2 are supported.</li>
<li><code>&lt;out-proxy&gt;</code>, optional, should be defined as <code>PROXY</code> or <code>PROXY-V2</code> if the upstream service expect connections using the PROXY protocol v2. Use <code>PROXY-V1</code> instead if the upstream service only support v1 protocol. Leave empty to connect without using the PROXY protocol.</li>
<li><code>&lt;namespace/secret-name&gt;</code>, optional, used to configure SSL/TLS over the TCP connection. Secret should have <code>tls.crt</code> and <code>tls.key</code> pair used on TLS handshake. Leave empty to not use ssl-offload.</li>
<li><code>&lt;check-interval&gt;</code>, added in v0.10, optional and defaults to <code>2s</code>, configures a TCP check interval. Declare <code>-</code> (one single dash) as the time to disable it. Valid time is a number and a mandatory suffix: <code>us</code>, <code>ms</code>, <code>s</code>, <code>m</code>, <code>h</code> or <code>d</code>.</li>
<li><code>&lt;namespace/secret-name&gt;</code>, added in v0.10, optional, used to configure SSL/TLS client verification over the TCP connection. Secret should have <code>ca.crt</code> and optional <code>ca.crl</code>. Leave empty to not use ssl client verification.</li>
</ol>

<p>Optional fields can be skipped using consecutive colons.</p>

<p>In the example below:</p>

<pre><code>...
data:
  &quot;3306&quot;: &quot;default/mysql:3306::::-&quot;
  &quot;5432&quot;: &quot;default/pgsql:5432::::1s&quot;
  &quot;8000&quot;: &quot;system-prod/http:8000::PROXY-V1&quot;
  &quot;9900&quot;: &quot;system-prod/admin:9900:PROXY::system-prod/tcp-9900&quot;
  &quot;9990&quot;: &quot;system-prod/admin:9999::PROXY-V2&quot;
  &quot;9995&quot;: &quot;system-prod/admin:9900:::system-prod/tcp-9995::system-prod/tcp-9995-ca&quot;
  &quot;9999&quot;: &quot;system-prod/admin:9999:PROXY:PROXY&quot;
</code></pre>

<p>HAProxy will listen 7 new ports:</p>

<ul>
<li><code>3306</code> will proxy to a <code>mysql</code> service on <code>default</code> namespace. Check interval is disabled.</li>
<li><code>5432</code> will proxy to a <code>pgsql</code> service on <code>default</code> namespace. Check interval is defined to run on every second.</li>
<li><code>8000</code> will proxy to <code>http</code> service, port <code>8000</code>, on the <code>system-prod</code> namespace. The upstream service will expect connections using the PROXY protocol but it only supports v1.</li>
<li><code>9900</code> will proxy to <code>admin</code> service, port <code>9900</code>, on the <code>system-prod</code> namespace. Clients should connect using the PROXY protocol v1 or v2. Upcoming connections should be encrypted, HAProxy will ssl-offload data using crt/key provided by <code>system-prod/tcp-9900</code> secret.</li>
<li><code>9990</code> and <code>9999</code> will proxy to the same <code>admin</code> service and <code>9999</code> port and the upstream service will expect connections using the PROXY protocol v2. The HAProxy frontend, however, will only expect PROXY protocol v1 or v2 on it&rsquo;s port <code>9999</code>.</li>
<li><code>9995</code> will proxy to <code>admin</code> service, port <code>9900</code>, on the <code>system-prod</code> namespace. Upcoming connections should be encrypted, HAProxy will ssl-offload data using crt/key provided by <code>system-prod/tcp-9995</code> secret. Furthermore, clients must present a certificate that will be valid under the certificate authority (and optional certificate revocation list) provded in the <code>system-prod/tcp-9995-ca</code> secret.</li>
</ul>

<p>Note: Check interval was added in v0.10 and defaults to <code>2s</code>. All declared services has check interval enabled, except <code>3306</code> which disabled it.</p>

<hr />

<h2 id="verify-hostname">&ndash;verify-hostname</h2>

<p>Ingress resources has <code>spec/tls[]/secretName</code> attribute to override the default X509 certificate.
As a default behavior the certificates are validated against the hostname in order to match the
SAN extension or CN (CN only up to <code>v0.4</code>). Invalid certificates, ie certificates which doesn&rsquo;t
match the hostname are discarded and a warning is logged into the ingress controller logging.</p>

<p>Use <code>--verify-hostname=false</code> argument to bypass this validation. If used, HAProxy will provide
the certificate declared in the <code>secretName</code> ignoring if the certificate is or is not valid.</p>

<hr />

<h2 id="wait-before-shutdown">&ndash;wait-before-shutdown</h2>

<p>If argument <code>--wait-before-shutdown</code> is defined, controller will wait defined time in seconds
before it starts shutting down components when SIGTERM was received. By default, it&rsquo;s 0, which means
the controller starts shutting down itself right after signal was sent.</p>

<hr />

<h2 id="watch-namespace">&ndash;watch-namespace</h2>

<p>By default the proxy will be configured using all namespaces from the Kubernetes cluster. Use
<code>--watch-namespace</code> with the name of a namespace to watch and build the configuration of a
single namespace.</p>

	<div class="text-muted mt-5 pt-3 border-top">Last modified July 9, 2021: <a  href="https://github.com/jcmoraisjr/haproxy-ingress/commit/f1efccaddbe267ae2c7a35f7b8b8f27153f75171">add disable-config-keywords command-line options (f1efccad)</a>
</div>
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-2 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" href="https://kubernetes.slack.com/channels/haproxy-ingress">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Users mailing list" aria-label="Users mailing list">
    <a class="text-white" target="_blank" href="https://groups.google.com/forum/#!forum/haproxy-ingress">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" target="_blank" href="https://stackoverflow.com/questions/tagged/haproxy-ingress">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/jcmoraisjr/haproxy-ingress">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-8 text-center py-2 order-sm-2">
        
          <small class="text-white">Made with <div class="fa fa-heart"></div> & <div class="fa fa-coffee"></div> | &copy; 2023 The HAProxy Ingress Controller Authors</small>
        
        <small class="text-white"> | Image by <a href="https://pixabay.com/users/TheDigitalArtist-202249/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3866609" target="_blank">Pete Linforth</a> from <a href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3866609" target="_blank">Pixabay</a></small>
        
	
		<p class="mt-2"><a href="/v0.10/about/">About</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>







<script src="/v0.10/js/main.min.2a536089c497f0ee43bc6b77ebb7a56e45abbf1fe4384fc31f5d73ef4eda91e9.js" integrity="sha256-KlNgicSX8O5DvGt367elbkWrvx/kOE/DH11z707akek=" crossorigin="anonymous"></script>



  </body>
</html>